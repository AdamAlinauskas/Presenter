@model Domain.Conversation

@{
    Layout = "~/Views/Conversation/Layout.cshtml";
}

<nav class="navbar is-dark">
    <div class="navbar-menu">
        <div class="navbar-start">
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link">Logged in as @User.Identity.Name</a>
                <div class="navbar-dropdown">
                    <a class="navbar-item" href="/Account/Logout">Log out</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="columns" style="margin:0; height:calc(100vh - 56px)">
    <section class="mt-presentation column is-two-thirds">
        <h1 class="title" style="margin: 60px 0 20px 0">@Model.Topic</h1>
        @if (ViewBag.CurrentUserIsMod) {
            <p>You are the moderator</p>
        } else {
            <p>Moderated by @Model.CreatedBy.Name</p>
        }
        <p>Presentation content goes here</p>
    </section>

    <div class="column">
        <section id="messages" class="mt-messages"></section>
        <form id="add-message" class="columns is-mobile">
            <input type="hidden" name="conversationId" value="@Model.Id" />
            <div class="column">
                <input id="message" name="message" placeholder="Message" class="input" autocomplete="off" />
            </div>
            <div class="column is-narrow">
                <input type="submit" value="Send" class="button is-primary"/>
            </div>
        </form>
    </div>
</div>

<template id="message-template">
    <div class="media is-info mt-media">
        <figure class="media-left">
            <p class="image is-32x32">
            <img src="" class="mt-author-picture">
            </p>
        </figure>
        <div class="media-content">
            <div class="content">
                <strong class="mt-author"></strong><br/>
                <div class="mt-message"></div>
                <small><a class="mt-reply">Reply</a></small>
                <form class="columns is-mobile mt-reply-form is-hidden">
                    <input type="hidden" name="conversationId" value="@Model.Id" />
                    <input type="hidden" name="messageId" class="mt-message-id"/>
                    <div class="column">
                        <input name="message" placeholder="Message" class="input mt-message-input" autocomplete="off" />
                    </div>
                    <div class="column is-narrow">
                        <input type="submit" value="Send" class="button is-primary"/>
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>
</div>

<template id="message-reply-template">
    <div class="media is-info mt-media">
        <figure class="media-left">
            <p class="image is-32x32">
            <img src="" class="mt-author-picture">
            </p>
        </figure>
        <div class="media-content">
            <strong class="mt-author"></strong><br/>
            <div class="mt-message"></div>
        </div>
    </div>
</template>

<script type="text/javascript">
    window.conversationInfo = @Json.Serialize(new {
        id = Model.Id,
        isMod = ViewBag.CurrentUserIsMod
    });
</script>
<script type="text/javascript" src="/scripts/conversation/conversation.js"></script>